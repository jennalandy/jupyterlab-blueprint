{"version":3,"file":"Customizer.js","sourceRoot":"../src/","sources":["Customizer.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { BaseComponent, IBaseProps } from './BaseComponent';\r\nimport { Customizations, ICustomizations, Settings, SettingsFunction } from './Customizations';\r\n\r\nexport interface ICustomizerContext {\r\n  customizations: ICustomizations;\r\n}\r\n\r\nexport const CustomizerContext = React.createContext<ICustomizerContext>({\r\n  customizations: {\r\n    settings: {},\r\n    scopedSettings: {}\r\n  }\r\n});\r\n\r\nexport type ICustomizerProps = IBaseProps &\r\n  Partial<{\r\n    /**\r\n     * @description\r\n     * Settings are used as general settings for the React tree below.\r\n     * Components can subscribe to receive the settings by using `customizable`.\r\n     *\r\n     * @example\r\n     * Settings can be represented by a plain object that contains the key value pairs.\r\n     * ```\r\n     *  <Customizer settings={{ color: 'red' }} />\r\n     * ```\r\n     * or a function that receives the current settings and returns the new ones\r\n     * ```\r\n     *  <Customizer settings={(currentSettings) => ({ ...currentSettings, color: 'red' })} />\r\n     * ```\r\n     */\r\n    settings: Settings | SettingsFunction;\r\n    /**\r\n     * @description\r\n     * Scoped settings are settings that are scoped to a specific scope. The\r\n     * scope is the name that is passed to the `customizable` function when the\r\n     * the component is customized.\r\n     *\r\n     * @example\r\n     * Scoped settings can be represented by a plain object that contains the key value pairs.\r\n     * ```\r\n     *  const myScopedSettings = {\r\n     *    Button: { color: 'red' };\r\n     *  };\r\n     *\r\n     *  <Customizer scopedSettings={myScopedSettings} />\r\n     * ```\r\n     * or a function that receives the current settings and returns the new ones\r\n     * ```\r\n     *  const myScopedSettings = {\r\n     *    Button: { color: 'red' };\r\n     *  };\r\n     *\r\n     *  <Customizer scopedSettings={(currentScopedSettings) => ({ ...currentScopedSettings, ...myScopedSettings })} />\r\n     * ```\r\n     */\r\n    scopedSettings: Settings | SettingsFunction;\r\n  }>;\r\n\r\n/**\r\n * The Customizer component allows for default props to be mixed into components which\r\n * are decorated with the customizable() decorator, or use the styled HOC. This enables\r\n * injection scenarios like:\r\n *\r\n * 1. render svg icons instead of the icon font within all buttons\r\n * 2. inject a custom theme object into a component\r\n *\r\n * Props are provided via the settings prop which should be one of the following:\r\n * - A json map which contains 1 or more name/value pairs representing injectable props.\r\n * - A function that receives the current settings and returns the new ones that apply to the scope\r\n *\r\n * @public\r\n */\r\nexport class Customizer extends BaseComponent<ICustomizerProps> {\r\n  public componentDidMount(): void {\r\n    Customizations.observe(this._onCustomizationChange);\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    Customizations.unobserve(this._onCustomizationChange);\r\n  }\r\n\r\n  public render(): React.ReactElement<{}> {\r\n    return (\r\n      <CustomizerContext.Consumer>\r\n        {(parentContext: ICustomizerContext) => {\r\n          const newContext = mergeCustomizations(this.props, parentContext);\r\n\r\n          return <CustomizerContext.Provider value={newContext}>{this.props.children}</CustomizerContext.Provider>;\r\n        }}\r\n      </CustomizerContext.Consumer>\r\n    );\r\n  }\r\n\r\n  private _onCustomizationChange = () => this.forceUpdate();\r\n}\r\n\r\nexport function mergeCustomizations(props: ICustomizerProps, parentContext: ICustomizerContext): ICustomizerContext {\r\n  const { customizations = { settings: {}, scopedSettings: {} } } = parentContext || {};\r\n\r\n  return {\r\n    customizations: {\r\n      settings: mergeSettings(customizations.settings, props.settings),\r\n      scopedSettings: mergeScopedSettings(customizations.scopedSettings, props.scopedSettings)\r\n    }\r\n  };\r\n}\r\n\r\nfunction mergeSettings(oldSettings: Settings = {}, newSettings?: Settings | SettingsFunction): Settings {\r\n  const mergeSettingsWith = isSettingsFunction(newSettings) ? newSettings : settingsMergeWith(newSettings);\r\n\r\n  return mergeSettingsWith(oldSettings);\r\n}\r\n\r\nfunction mergeScopedSettings(oldSettings: Settings = {}, newSettings?: Settings | SettingsFunction): Settings {\r\n  const mergeSettingsWith = isSettingsFunction(newSettings) ? newSettings : scopedSettingsMergeWith(newSettings);\r\n\r\n  return mergeSettingsWith(oldSettings);\r\n}\r\n\r\nfunction isSettingsFunction(settings?: Settings | SettingsFunction): settings is SettingsFunction {\r\n  return typeof settings === 'function';\r\n}\r\n\r\nfunction settingsMergeWith(newSettings?: object): (settings: Settings) => Settings {\r\n  return (settings: Settings) => (newSettings ? { ...settings, ...newSettings } : settings);\r\n}\r\n\r\nfunction scopedSettingsMergeWith(scopedSettingsFromProps: Settings = {}): (scopedSettings: Settings) => Settings {\r\n  return (oldScopedSettings: Settings): Settings => {\r\n    const newScopedSettings: Settings = { ...oldScopedSettings };\r\n\r\n    for (let scopeName in scopedSettingsFromProps) {\r\n      if (scopedSettingsFromProps.hasOwnProperty(scopeName)) {\r\n        newScopedSettings[scopeName] = { ...oldScopedSettings[scopeName], ...scopedSettingsFromProps[scopeName] };\r\n      }\r\n    }\r\n\r\n    return newScopedSettings;\r\n  };\r\n}\r\n"]}